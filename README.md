# BAC analysis pipeline(s)

## Usage

Check out the code into your working directory.

```bash
git clone https://github.com/huddlej/bac_analysis.git .
```

Create a list of clone ids to analyze. If the clones are already present in
GenBank with an accession (e.g., AC202642.3), create a list of accessions with
one per line in a single text file and move on to modifying `config.json` below.

If the clones are not in GenBank and are only available locally, create a list
of the original clone ids (e.g., CH259-157F4) with one id per
line. Additionally, create a separate tab-delimited file with the clone id in
the first column and the absolute path to the clone FASTA sequence in the second
column.

Copy a configuration template from `config_templates/` to `config.json` and
modify the settings in `config.json` for your organism and clones. If you have
local clones, add a configuration setting called `clone_paths` with the absolute
path to the tab-delimited list of clone paths.

Setup the environment for the pipeline.

```bash
. config.sh
```

Run the pipeline.

```bash
snakemake
```

Alternately, the pipeline can be run on a grid engine cluster (e.g., UGE) with
as many processes as you like as specified by the `-j` flag. The following
example runs at most 10 simultaneous jobs on an SGE cluster.

```bash
snakemake --cluster "qsub {params.sge_opts}" -j 10 -w 30
```

### Running specific sub-pipelines

The complete BAC analysis pipeline consists of several sub-pipelines that can be
usefully executed on their own. To run a specific sub-pipeline without running
the complete analysis suite, identify the final output file you want to create
from the rules in `rules/` and provide that output file as the request to
snakemake.

For example, to only run the liftover pipeline (map clones to a specific
reference), one would run the following command.

```bash
snakemake --cluster "qsub {params.sge_opts}" -j 10 -w 30 liftover.bed
```

The following table lists the available sub-pipelines and their corresponding
final output files to request from snakemake.

| Pipeline name | Description | Final output file |
| ------------- | ----------- | ----------------- |
| genes | Annotate genes on clones with mRNA and GMAP | mRNA.named.bed |
| genes_by_lastz | Annotate genes on clones with mRNA and lastz | gene_liftover.bed |
| liftover | Place clones to their best location in the reference | liftover.bed |
| segmental_duplications | Liftover duplications annotated in the reference to the coordinate system of the clones | segmental_duplications_in_bacs.bed |
| sequences | Acquire and mask clones with RepeatMasker and TRF | all_masked |
| shared_sequence | Find all sequences shared between clones | shared_sequence_between_clones.bed |
| tandem_repeats | Find all self-self ("tandem") repeats within each clone | tandem_repeats.bed |
| tracks | Create a track hub for all annotations generated by the complete suite | tracks/genomes.txt |
| wssd | Identify duplications in clones by WSSD | wins/wssdGE10K_nogap.tab |
